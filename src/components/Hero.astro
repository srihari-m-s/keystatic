---
import { isNonEmptyString } from "@/utils/string";
import { getContentImageLoader } from "@/utils/contentImages";
import Image from "astro/components/Image.astro";

interface CtaItem {
  label: string;
  link: string;
}

interface Props {
  title: string;
  subtitle: string;
  image: string;
  cta?: CtaItem[] | null;
}

const { title, subtitle, image: imagePath, cta } = Astro.props as Props;

const isCtaItem = (item: unknown): item is CtaItem => {
  if (typeof item !== "object" || item === null) return false;

  const candidate = item as Partial<CtaItem>;

  return isNonEmptyString(candidate.label) && isNonEmptyString(candidate.link);
};

const ctaButtons: CtaItem[] = Array.isArray(cta) ? cta.filter(isCtaItem) : [];
const imageLoader = getContentImageLoader(imagePath);
---

<div class="flex flex-col md:flex-row gap-10 items-center">
  <div class="space-y-4 flex-1">
    <h1 class="text-3xl sm:text-4xl lg:text-5xl">
      {title}
    </h1>
    <p class="text-xl text-base-conten">
      {subtitle}
    </p>

    {
      ctaButtons.length > 0 && (
        <div class="mt-4 flex flex-wrap gap-3">
          {ctaButtons.map((button, index) => {
            const variantClasses =
              index === 0 ? "btn-primary" : "btn-soft btn-secondary";

            return (
              <a
                href={button.link}
                class={`btn no-underline ${variantClasses}`}
              >
                {button.label}
              </a>
            );
          })}
        </div>
      )
    }
  </div>

  <div
    class="flex-none flex justify-center pattern-dots-md text-primary mask mask-squircle p-6"
  >
    <Image src={imageLoader()} alt={title} class="w-64 h-64 object-cover" />
  </div>
</div>
